
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="NeSI">
      
      
        <link rel="canonical" href="https://nesi.github.io/snakemake_workshop/workshop_material/04_leveling_up_your_workflow/">
      
      
        <link rel="prev" href="../03_create_a_basic_workflow/">
      
      
        <link rel="next" href="../05_we_want_more/">
      
      
      <link rel="icon" href="../../theme_images/nesi_logo.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.6">
    
    
      
        <title>04 - Leveling up your workflow! - Automate Your Workflow With Snakemake</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mukta";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#04-leveling-up-your-workflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
<!-- Custom Banner -->
<div class="banner">
    <p style="color:white; display:inline;font-size: 160%;">This repository is in the early stages of development (Beta Version)</p>
</div>

<!-- Original Header -->


  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Automate Your Workflow With Snakemake" class="md-header__button md-logo" aria-label="Automate Your Workflow With Snakemake" data-md-component="logo">
      
  <img src="../../theme_images/nesi_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Automate Your Workflow With Snakemake
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              04 - Leveling up your workflow!
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nesi/snakemake_workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nesi/snakemake_workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>

    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Automate Your Workflow With Snakemake" class="md-nav__button md-logo" aria-label="Automate Your Workflow With Snakemake" data-md-component="logo">
      
  <img src="../../theme_images/nesi_logo.png" alt="logo">

    </a>
    Automate Your Workflow With Snakemake
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nesi/snakemake_workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nesi/snakemake_workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop material
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workshop material
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../01_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 - Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../02_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 - Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../03_create_a_basic_workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 - Create a basic workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    04 - Leveling up your workflow!
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    04 - Leveling up your workflow!
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catching-up" class="md-nav__link">
    Catching up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41-use-a-profile-for-hpc" class="md-nav__link">
    4.1 Use a profile for HPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-pull-out-parameters" class="md-nav__link">
    4.2 Pull out parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-pull-out-user-configurable-options" class="md-nav__link">
    4.3 Pull out user configurable options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-leave-messages-for-the-user" class="md-nav__link">
    4.4 Leave messages for the user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-create-temporary-files" class="md-nav__link">
    4.5 Create temporary files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-generating-a-snakemake-report" class="md-nav__link">
    4.6 Generating a snakemake report
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-linting-your-workflow" class="md-nav__link">
    4.7 Linting your workflow
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../05_we_want_more/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 - We want more!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Supplementary
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Supplementary
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../supplementary/99_appendix_setup_on_your_machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supp. 1 - Setup on your machine using conda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../supplementary/99_appendix_use_conda_environments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supp. 2 - Use conda environments
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catching-up" class="md-nav__link">
    Catching up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41-use-a-profile-for-hpc" class="md-nav__link">
    4.1 Use a profile for HPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-pull-out-parameters" class="md-nav__link">
    4.2 Pull out parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-pull-out-user-configurable-options" class="md-nav__link">
    4.3 Pull out user configurable options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-leave-messages-for-the-user" class="md-nav__link">
    4.4 Leave messages for the user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-create-temporary-files" class="md-nav__link">
    4.5 Create temporary files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-generating-a-snakemake-report" class="md-nav__link">
    4.6 Generating a snakemake report
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-linting-your-workflow" class="md-nav__link">
    4.7 Linting your workflow
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="04-leveling-up-your-workflow">04 - Leveling up your workflow!<a class="headerlink" href="#04-leveling-up-your-workflow" title="Permanent link">&para;</a></h1>
<h2 id="catching-up">Catching up<a class="headerlink" href="#catching-up" title="Permanent link">&para;</a></h2>
<div class="admonition file-code">
<p class="admonition-title">From section 03, you should have the following Snakefile:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ --paired --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</div>
<p><br></p>
<h2 id="41-use-a-profile-for-hpc">4.1 Use a profile for HPC<a class="headerlink" href="#41-use-a-profile-for-hpc" title="Permanent link">&para;</a></h2>
<p>In section 3.16, we have seen that a snakemake workflow can be run on an HPC cluster.
To reduce the boilerplate, we can use a <a href="https://snakemake.readthedocs.io/en/stable/executing/cli.html#profiles">configuration profile</a> to configure default options.
In this case, we use it to set the <code>--cluster</code> and the <code>--jobs</code> options.</p>
<div class="admonition terminal-2">
<p class="admonition-title">Make a <code>slurm</code> profile folder</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># create the profile folder</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>mkdir<span class="w"> </span>slurm
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>touch<span class="w"> </span>slurm/config.yaml
</code></pre></div>
</div>
<div class="admonition file-code">
<p class="admonition-title">write the following to config.yaml</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>jobs:<span class="w"> </span><span class="m">20</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>cluster:<span class="w"> </span><span class="s2">&quot;sbatch --time 00:10:00 --mem 512MB --cpus-per-task 8 --account nesi99991&quot;</span>
</code></pre></div>
</div>
<div class="admonition terminal-2">
<p class="admonition-title">Then run the snakemake workflow using the <code>slurm</code> profile</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div></p>
</div>
<p>If you interrupt the execution of a snakemake workflow using <KBD>CTRL+C</KBD>, already submitted Slurm jobs won't be cancelled.
We tell snakemake how to cancel Slurm jobs using <code>scancel</code> via the <code>--cluster-cancel</code> option and adding <code>--parsable</code> to the <code>sbatch</code> command, to make it return the job ID.</p>
<div class="admonition code-compare">
<p class="admonition-title">Edit config.yaml</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>jobs: 20
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="gd">- cluster: &quot;sbatch --time 00:10:00 --mem 512MB --cpus-per-task 8&quot;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="gi">+ cluster: &quot;sbatch --parsable --time 00:10:00 --mem 512MB --cpus-per-task 8&quot;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="gi">+ cluster-cancel: scancel</span>
</code></pre></div>
</div>
<p>You can specify different resources (memory, cpus, gpus, etc.) for each target in the workflow and refer to them in the <code>cluster</code> option using placeholders.
Default resources for all rules can also be set using the <code>default-resources</code> option.</p>
<p>Update the profile <code>slurm/config.yaml</code> file as follows (using a multiline option to improve readability)</p>
<div class="admonition code-compare">
<p class="admonition-title">Edit config.yml</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>jobs: 20
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="gd">- cluster: &quot;sbatch --parsable --time 00:10:00 --mem 512MB --cpus-per-task 8&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="gi">+ cluster:</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="gi">+     sbatch</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="gi">+         --parsable</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="gi">+         --time {resources.time_min}</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="gi">+         --mem {resources.mem_mb}</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="gi">+         --cpus-per-task {resources.cpus}</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="gi">+         --account nesi99991</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="gi">+ default-resources: [cpus=2, mem_mb=512, time_min=10]</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>cluster-cancel: scancel
</code></pre></div>
</div>
<p>and add resources definitions in the workflow.
Here we give more CPU resources to <code>trim_galore</code> to make it run faster.</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a># define samples from data directory using wildcards
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>rule all:
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w"> </span>   input:
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a># workflow
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>rule fastqc:
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w"> </span>   input:
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w"> </span>   output:
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w"> </span>   log:
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w"> </span>       &quot;FastQC/0.11.9&quot;
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w"> </span>   shell:
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}&quot;
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>rule multiqc:
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w"> </span>   input:
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w"> </span>   output:
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w"> </span>   log:
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w"> </span>       &quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w"> </span>   shell:
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ &amp;&gt; {log}&quot;
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>rule trim_galore:
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w"> </span>   input:
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w"> </span>   output:
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w"> </span>   log:
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w"> </span>       &quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="gi">+   resources:</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="gi">+       cpus=8</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="w"> </span>   shell:
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current slurm profile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>jobs: 20
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>cluster:
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    sbatch
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>        --parsable
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>        --time {resources.time_min}
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>        --mem {resources.mem_mb}
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        --cpus-per-task {resources.cpus}
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        --account nesi99991
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>cluster-cancel: scancel
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>        <span class="n">cpus</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ --paired --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal-2">
<p class="admonition-title">Run the workflow again</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a># run dryrun/run again
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>snakemake --dryrun --profile slurm --use-envmodules
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div></p>
<ul>
<li>If you monitor the progress of your jobs using <code>squeue</code>, you will notice that some jobs now request 2 or 8 CPUs.</li>
</ul>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>JOBID         USER     ACCOUNT   NAME        CPUS MIN_MEM PARTITI START_TIME     TIME_LEFT STATE    NODELIST(REASON)
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>26763281      lkemp    nesi99991 spawner-jupy   4      4G interac 2022-05-11T1     7:21:18 RUNNING  wbn003
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>26763492      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn144
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>26763493      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn212
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>26763494      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn145
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>26763495      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn146
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>26763496      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn217
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>26763497      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn229
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Now looking at the content of our workflow folder, it is getting cluttered with Slurm log files:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>ls<span class="w"> </span>-lh
</code></pre></div>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>total<span class="w"> </span><span class="m">1</span>.8M
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">4</span>.2K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10<span class="w"> </span>dag_1.png
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">3</span>.8K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:13<span class="w"> </span>dag_2.png
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span>12K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:16<span class="w"> </span>dag_3.png
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span>20K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:19<span class="w"> </span>dag_4.png
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span>15K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:21<span class="w"> </span>dag_5.png
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span>12K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:23<span class="w"> </span>dag_6.png
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span>26K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:24<span class="w"> </span>dag_7.png
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>drwxrws---+<span class="w"> </span><span class="m">5</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">4</span>.0K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:25<span class="w"> </span>logs
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span>11K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:24<span class="w"> </span>rulegraph_1.png
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>drwxrws---+<span class="w"> </span><span class="m">3</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">4</span>.0K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:34<span class="w"> </span>slurm
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27<span class="w"> </span>slurm-26763403.out
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27<span class="w"> </span>slurm-26763404.out
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27<span class="w"> </span>slurm-26763405.out
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27<span class="w"> </span>slurm-26763406.out
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27<span class="w"> </span>slurm-26763407.out
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27<span class="w"> </span>slurm-26763408.out
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">865</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:29<span class="w"> </span>slurm-26763409.out
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:30<span class="w"> </span>slurm-26763418.out
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:30<span class="w"> </span>slurm-26763419.out
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:30<span class="w"> </span>slurm-26763420.out
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:30<span class="w"> </span>slurm-26763421.out
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:30<span class="w"> </span>slurm-26763422.out
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:30<span class="w"> </span>slurm-26763423.out
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">865</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:32<span class="w"> </span>slurm-26763431.out
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:33<span class="w"> </span>slurm-26763435.out
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:34<span class="w"> </span>slurm-26763436.out
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:33<span class="w"> </span>slurm-26763437.out
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">837</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:34<span class="w"> </span>slurm-26763438.out
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:34<span class="w"> </span>slurm-26763439.out
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">809</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:34<span class="w"> </span>slurm-26763440.out
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">865</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:35<span class="w"> </span>slurm-26763444.out
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">857</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:36<span class="w"> </span>slurm-26763447.out
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">829</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:36<span class="w"> </span>slurm-26763448.out
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">857</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:36<span class="w"> </span>slurm-26763449.out
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">857</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:36<span class="w"> </span>slurm-26763450.out
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">829</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:36<span class="w"> </span>slurm-26763451.out
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">829</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:36<span class="w"> </span>slurm-26763452.out
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w">  </span><span class="m">885</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:37<span class="w"> </span>slurm-26763454.out
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">1</span>.8K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:34<span class="w"> </span>Snakefile
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Let's clean this and create a dedicated folder <code>logs/slurm</code> for future log files:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># remove slurm log files</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>rm<span class="w"> </span>*.out
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># create a new folder for Slurm log files</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>mkdir<span class="w"> </span>logs/slurm
</code></pre></div></p>
</div>
<div class="admonition code-compare">
<p class="admonition-title">then instruct Slurm to save its log files in it, in the profile <code>slurm/config.yaml</code> file</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>jobs: 20
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>cluster:
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w"> </span>   sbatch
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w"> </span>       --parsable
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w"> </span>       --time {resources.time_min}
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w"> </span>       --mem {resources.mem_mb}
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w"> </span>       --cpus-per-task {resources.cpus}
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="gi">+       --output logs/slurm/slurm-%j-{rule}.out</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w"> </span>       --account nesi99991
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>cluster-cancel: scancel
</code></pre></div>
</div>
<p>Note that <code>logs/slurm/slurm-%j-{rule}.out</code> contains a placeholder <code>{rule}</code>, which will be replaced by the name of the rule during the execution of the workflow.</p>
<p>Finally, to improve the communication between Snakemake and Slurm, we meed an additional script translating Slurm job status for Snakemake.
The <code>--cluster-status</code> option is used to tell Snakemake which script to use.</p>
<div class="admonition terminal-2">
<p class="admonition-title">Create an executable <code>status.py</code> file</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># create an empty file</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>touch<span class="w"> </span>status.py
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># make it executable</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>status.py
</code></pre></div></p>
<ul>
<li>and copy the following content in it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kn">import</span> <span class="nn">subprocess</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kn">import</span> <span class="nn">sys</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">jobid</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="n">output</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sacct -j </span><span class="si">%s</span><span class="s2"> --format State --noheader | head -1 | awk &#39;{print $1}&#39;&quot;</span> <span class="o">%</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="n">running_status</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span> <span class="s2">&quot;CONFIGURING&quot;</span><span class="p">,</span> <span class="s2">&quot;COMPLETING&quot;</span><span class="p">,</span> <span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span> <span class="s2">&quot;SUSPENDED&quot;</span><span class="p">]</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="k">if</span> <span class="s2">&quot;COMPLETED&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">r</span> <span class="ow">in</span> <span class="n">output</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">running_status</span><span class="p">):</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running&quot;</span><span class="p">)</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<details class="code-compare">
<summary>Then modify the profile <code>slurm/config.yaml</code> file</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>jobs: 20
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>cluster:
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w"> </span>   sbatch
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w"> </span>       --parsable
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w"> </span>       --time {resources.time_min}
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w"> </span>       --mem {resources.mem_mb}
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w"> </span>       --cpus-per-task {resources.cpus}
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w"> </span>       --output logs/slurm/slurm-%j-{rule}.out
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w"> </span>       --account nesi99991
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>cluster-cancel: scancel
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="gi">+ cluster-status: ./status.py</span>
</code></pre></div>
</details>
<details class="file-code">
<summary>Current slurm profile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>jobs: 20
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>cluster:
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    sbatch
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>        --parsable
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        --time {resources.time_min}
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>        --mem {resources.mem_mb}
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>        --cpus-per-task {resources.cpus}
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        --output logs/slurm/slurm-%j-{rule}.out
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>        --account nesi99991
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>cluster-cancel: scancel
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>cluster-status: ./status.py
</code></pre></div>
</details>
<p><br></p>
<p>Once all of this is in place, we can:</p>
<div class="admonition quote">
<ul>
<li>submit Slurm jobs with the right resources per Snakemake rule,</li>
<li>cancel the workflow and Slurms jobs using CTRL-C,</li>
<li>keep all slurm jobs log files in a dedicated folder,</li>
<li>and make sure Snakemake reports Slurm jobs failures.</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<p>Run the snakemake workflow with Slurm jobs then use <code>scancel JOBID</code> to cancel some Slurm. See how Snakemake reacts with and without the <code>status.py</code> script.</p>
</div>
<h2 id="42-pull-out-parameters">4.2 Pull out parameters<a class="headerlink" href="#42-pull-out-parameters" title="Permanent link">&para;</a></h2>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a># define samples from data directory using wildcards
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>rule all:
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w"> </span>   input:
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a># workflow
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>rule fastqc:
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w"> </span>   input:
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w"> </span>   output:
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w"> </span>   log:
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="w"> </span>       &quot;FastQC/0.11.9&quot;
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w"> </span>   shell:
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}&quot;
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>rule multiqc:
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w"> </span>   input:
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w"> </span>   output:
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w"> </span>   log:
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w"> </span>       &quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="w"> </span>   shell:
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ &amp;&gt; {log}&quot;
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>rule trim_galore:
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="w"> </span>   input:
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="w"> </span>   output:
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="gi">+   params:</span>
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="gi">+       &quot;--paired&quot;</span>
<a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a><span class="w"> </span>   log:
<a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a><span class="w"> </span>       &quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;
<a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="w"> </span>   resources:
<a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a><span class="w"> </span>       cpus=8
<a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a><span class="w"> </span>   shell:
<a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="gd">-       &quot;trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a><span class="gi">+       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;</span>
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>        <span class="n">cpus</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal-2">
<p class="admonition-title">Run a dryrun to check it works</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a># run dryrun again
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>snakemake --dryrun --profile slurm --use-envmodules
</code></pre></div></p>
</div>
<h2 id="43-pull-out-user-configurable-options">4.3 Pull out user configurable options<a class="headerlink" href="#43-pull-out-user-configurable-options" title="Permanent link">&para;</a></h2>
<p>We can separate the user configurable options away from the workflow. This supports reproducibility by minimising the chance the user makes changes to the core workflow.</p>
<p>Create a configuration file in a new directory <code>config/</code></p>
<p>File structure:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>demo_workflow/
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">      </span><span class="p">|</span>_______results/
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">      </span><span class="p">|</span>_______workflow/
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______logs/
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______slurm/
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______Snakefile
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______status.py
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">      </span><span class="p">|</span>_______config
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">                 </span><span class="p">|</span>_______config.yaml
</code></pre></div>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># create config directory</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>mkdir<span class="w"> </span>../config
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># create configuration file</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>touch<span class="w"> </span>../config/config.yaml
</code></pre></div></p>
</div>
<p>Now we need to pull out the parameters the user would likely need to configure. Let's give the user the option to pass any parameters they like to fastqc. In our <code>../config/config.yaml</code> file, add the configuration options and add a couple flags to be passed to fastqc and multiqc:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># set software parameters for...</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nt">PARAMS</span><span class="p">:</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="c1"># ... fastqc</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span><span class="nt">FASTQC</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;--kmers</span><span class="nv"> </span><span class="s">5&quot;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="c1"># ... multiqc</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">  </span><span class="nt">MULTIQC</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;--flat&quot;</span>
</code></pre></div>
<details class="code-compare">
<summary>Edit snakefile : In the Snakefile, tell Snakemake to grab the variables <code>PARAMS</code> from <code>../config/config.yaml</code></summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a># define samples from data directory using wildcards
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>rule all:
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w"> </span>   input:
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a># workflow
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>rule fastqc:
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w"> </span>   input:
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w"> </span>   output:
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="gi">+   params:</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="gi">+       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w"> </span>   log:
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="w"> </span>       &quot;FastQC/0.11.9&quot;
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w"> </span>   shell:
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="gd">-       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="gi">+       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a>
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a>rule multiqc:
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="w"> </span>   input:
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="w"> </span>   output:
<a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="gi">+   params:</span>
<a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="gi">+       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]</span>
<a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="w"> </span>   log:
<a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="w"> </span>       &quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;
<a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a><span class="w"> </span>   shell:
<a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a><span class="gd">-       &quot;multiqc {input} -o ../results/ &amp;&gt; {log}&quot;</span>
<a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a><span class="gi">+       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a>
<a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a>rule trim_galore:
<a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a><span class="w"> </span>   input:
<a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a><span class="w"> </span>   output:
<a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-33-49" name="__codelineno-33-49" href="#__codelineno-33-49"></a><span class="w"> </span>   params:
<a id="__codelineno-33-50" name="__codelineno-33-50" href="#__codelineno-33-50"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-33-51" name="__codelineno-33-51" href="#__codelineno-33-51"></a><span class="w"> </span>   log:
<a id="__codelineno-33-52" name="__codelineno-33-52" href="#__codelineno-33-52"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-33-53" name="__codelineno-33-53" href="#__codelineno-33-53"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-33-54" name="__codelineno-33-54" href="#__codelineno-33-54"></a><span class="w"> </span>       &quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;
<a id="__codelineno-33-55" name="__codelineno-33-55" href="#__codelineno-33-55"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-33-56" name="__codelineno-33-56" href="#__codelineno-33-56"></a><span class="w"> </span>   resources:
<a id="__codelineno-33-57" name="__codelineno-33-57" href="#__codelineno-33-57"></a><span class="w"> </span>       cpus=8
<a id="__codelineno-33-58" name="__codelineno-33-58" href="#__codelineno-33-58"></a><span class="w"> </span>   shell:
<a id="__codelineno-33-59" name="__codelineno-33-59" href="#__codelineno-33-59"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a>
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a>        <span class="n">cpus</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal-2">
<p class="admonition-title">Let's use our configuration file! Run workflow again:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div></p>
<details class="failure">
<summary>Didn't work? My error:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>KeyError<span class="w"> </span><span class="k">in</span><span class="w"> </span>line<span class="w"> </span><span class="m">19</span><span class="w"> </span>of<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile:
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="s1">&#39;PARAMS&#39;</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">19</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Snakemake can't find our 'Key' - we haven't told Snakemake where our config file is so it can't find our config variables. We can do this by passing the location of our config file to the <code>--configfile</code> flag</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a># run dryrun/run again
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="gd">- snakemake --dryrun --profile slurm --use-envmodules</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="gd">- snakemake --profile slurm --use-envmodules</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="gi">+ snakemake --dryrun --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="gi">+ snakemake --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
</code></pre></div></p>
</div>
<p>Alternatively, we can define our config file in our Snakefile in a situation where the configuration file is likely to always be named the same and be in the exact same location <code>../config/config.yaml</code> and you don't need the flexibility for the user to specify their own configuration files:</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a># define our configuration file
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="gi">+ configfile: &quot;../config/config.yaml&quot;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a># define samples from data directory using wildcards
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>rule all:
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w"> </span>   input:
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a># workflow
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>rule fastqc:
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w"> </span>   input:
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w"> </span>   output:
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w"> </span>   params:
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w"> </span>       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w"> </span>   log:
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w"> </span>       &quot;FastQC/0.11.9&quot;
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w"> </span>   shell:
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a>rule multiqc:
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w"> </span>   input:
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w"> </span>   output:
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w"> </span>   params:
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w"> </span>       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w"> </span>   log:
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w"> </span>       &quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="w"> </span>   shell:
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a>
<a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a>rule trim_galore:
<a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="w"> </span>   input:
<a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a><span class="w"> </span>   output:
<a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-41-50" name="__codelineno-41-50" href="#__codelineno-41-50"></a><span class="w"> </span>   params:
<a id="__codelineno-41-51" name="__codelineno-41-51" href="#__codelineno-41-51"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-41-52" name="__codelineno-41-52" href="#__codelineno-41-52"></a><span class="w"> </span>   log:
<a id="__codelineno-41-53" name="__codelineno-41-53" href="#__codelineno-41-53"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-41-54" name="__codelineno-41-54" href="#__codelineno-41-54"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-41-55" name="__codelineno-41-55" href="#__codelineno-41-55"></a><span class="w"> </span>       &quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;
<a id="__codelineno-41-56" name="__codelineno-41-56" href="#__codelineno-41-56"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-41-57" name="__codelineno-41-57" href="#__codelineno-41-57"></a><span class="w"> </span>   resources:
<a id="__codelineno-41-58" name="__codelineno-41-58" href="#__codelineno-41-58"></a><span class="w"> </span>       cpus=8
<a id="__codelineno-41-59" name="__codelineno-41-59" href="#__codelineno-41-59"></a><span class="w"> </span>   shell:
<a id="__codelineno-41-60" name="__codelineno-41-60" href="#__codelineno-41-60"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># define our configuration file</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">configfile</span><span class="p">:</span> <span class="s2">&quot;../config/config.yaml&quot;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="c1"># workflow</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a>
<a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-42-49" name="__codelineno-42-49" href="#__codelineno-42-49"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-42-50" name="__codelineno-42-50" href="#__codelineno-42-50"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-42-51" name="__codelineno-42-51" href="#__codelineno-42-51"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-42-52" name="__codelineno-42-52" href="#__codelineno-42-52"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-42-53" name="__codelineno-42-53" href="#__codelineno-42-53"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-42-54" name="__codelineno-42-54" href="#__codelineno-42-54"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-42-55" name="__codelineno-42-55" href="#__codelineno-42-55"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-42-56" name="__codelineno-42-56" href="#__codelineno-42-56"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-42-57" name="__codelineno-42-57" href="#__codelineno-42-57"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-42-58" name="__codelineno-42-58" href="#__codelineno-42-58"></a>        <span class="n">cpus</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-42-59" name="__codelineno-42-59" href="#__codelineno-42-59"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-42-60" name="__codelineno-42-60" href="#__codelineno-42-60"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<p>Then we don't need to specify where the configuration file is on the command line</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a># run dryrun/run again
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="gd">- snakemake --dryrun --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="gd">- snakemake --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="gi">+ snakemake --dryrun --profile slurm --use-envmodules</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="gi">+ snakemake --profile slurm --use-envmodules</span>
</code></pre></div></p>
</div>
<h2 id="44-leave-messages-for-the-user">4.4 Leave messages for the user<a class="headerlink" href="#44-leave-messages-for-the-user" title="Permanent link">&para;</a></h2>
<p>We can provide the user of our workflow more information on what is happening at each stage/rule of our workflow via the <code>message:</code> directive. We are able to call many variables such as:</p>
<ul>
<li>Input and output files <code>{input}</code> and <code>{output}</code></li>
<li>Specific input and output files such as <code>{input.R1}</code></li>
<li>Our <code>{params}</code>, <code>{log}</code> and <code>{threads}</code> directives</li>
</ul>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a># define our configuration file
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>configfile: &quot;../config/config.yaml&quot;
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a># define samples from data directory using wildcards
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>rule all:
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w"> </span>   input:
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a># workflow
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>rule fastqc:
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w"> </span>   input:
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w"> </span>   output:
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="w"> </span>   params:
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w"> </span>       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="w"> </span>   log:
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="w"> </span>       &quot;FastQC/0.11.9&quot;
<a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="gi">+   message:</span>
<a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="gi">+       &quot;Undertaking quality control checks {input}&quot;</span>
<a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="w"> </span>   shell:
<a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a>
<a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a>rule multiqc:
<a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a><span class="w"> </span>   input:
<a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="w"> </span>   output:
<a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a><span class="w"> </span>   params:
<a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="w"> </span>       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]
<a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="w"> </span>   log:
<a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-45-43" name="__codelineno-45-43" href="#__codelineno-45-43"></a><span class="w"> </span>       &quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;
<a id="__codelineno-45-44" name="__codelineno-45-44" href="#__codelineno-45-44"></a><span class="gi">+   message:</span>
<a id="__codelineno-45-45" name="__codelineno-45-45" href="#__codelineno-45-45"></a><span class="gi">+       &quot;Compiling a HTML report for quality control checks. Writing to {output}.&quot;</span>
<a id="__codelineno-45-46" name="__codelineno-45-46" href="#__codelineno-45-46"></a><span class="w"> </span>   shell:
<a id="__codelineno-45-47" name="__codelineno-45-47" href="#__codelineno-45-47"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-45-48" name="__codelineno-45-48" href="#__codelineno-45-48"></a>
<a id="__codelineno-45-49" name="__codelineno-45-49" href="#__codelineno-45-49"></a>rule trim_galore:
<a id="__codelineno-45-50" name="__codelineno-45-50" href="#__codelineno-45-50"></a><span class="w"> </span>   input:
<a id="__codelineno-45-51" name="__codelineno-45-51" href="#__codelineno-45-51"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-45-52" name="__codelineno-45-52" href="#__codelineno-45-52"></a><span class="w"> </span>   output:
<a id="__codelineno-45-53" name="__codelineno-45-53" href="#__codelineno-45-53"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-45-54" name="__codelineno-45-54" href="#__codelineno-45-54"></a><span class="w"> </span>   params:
<a id="__codelineno-45-55" name="__codelineno-45-55" href="#__codelineno-45-55"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-45-56" name="__codelineno-45-56" href="#__codelineno-45-56"></a><span class="w"> </span>   log:
<a id="__codelineno-45-57" name="__codelineno-45-57" href="#__codelineno-45-57"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-45-58" name="__codelineno-45-58" href="#__codelineno-45-58"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-45-59" name="__codelineno-45-59" href="#__codelineno-45-59"></a><span class="w"> </span>       &quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;
<a id="__codelineno-45-60" name="__codelineno-45-60" href="#__codelineno-45-60"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-45-61" name="__codelineno-45-61" href="#__codelineno-45-61"></a><span class="w"> </span>   resources:
<a id="__codelineno-45-62" name="__codelineno-45-62" href="#__codelineno-45-62"></a><span class="w"> </span>       cpus=8
<a id="__codelineno-45-63" name="__codelineno-45-63" href="#__codelineno-45-63"></a><span class="gi">+   message:</span>
<a id="__codelineno-45-64" name="__codelineno-45-64" href="#__codelineno-45-64"></a><span class="gi">+       &quot;Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads.&quot;</span>
<a id="__codelineno-45-65" name="__codelineno-45-65" href="#__codelineno-45-65"></a><span class="w"> </span>   shell:
<a id="__codelineno-45-66" name="__codelineno-45-66" href="#__codelineno-45-66"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># define our configuration file</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">configfile</span><span class="p">:</span> <span class="s2">&quot;../config/config.yaml&quot;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="c1"># workflow</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a>        <span class="s2">&quot;Undertaking quality control checks </span><span class="si">{input}</span><span class="s2">&quot;</span>
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a>
<a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a>        <span class="s2">&quot;Compiling a HTML report for quality control checks. Writing to </span><span class="si">{output}</span><span class="s2">.&quot;</span>
<a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a>
<a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-46-57" name="__codelineno-46-57" href="#__codelineno-46-57"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-46-58" name="__codelineno-46-58" href="#__codelineno-46-58"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-46-59" name="__codelineno-46-59" href="#__codelineno-46-59"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-46-60" name="__codelineno-46-60" href="#__codelineno-46-60"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-46-61" name="__codelineno-46-61" href="#__codelineno-46-61"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-46-62" name="__codelineno-46-62" href="#__codelineno-46-62"></a>        <span class="n">cpus</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-46-63" name="__codelineno-46-63" href="#__codelineno-46-63"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-46-64" name="__codelineno-46-64" href="#__codelineno-46-64"></a>        <span class="s2">&quot;Trimming using these parameter: </span><span class="si">{params}</span><span class="s2">. Writing logs to </span><span class="si">{log}</span><span class="s2">. Using </span><span class="si">{threads}</span><span class="s2"> threads.&quot;</span>
<a id="__codelineno-46-65" name="__codelineno-46-65" href="#__codelineno-46-65"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-46-66" name="__codelineno-46-66" href="#__codelineno-46-66"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a># remove output of last run
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>rm -r ../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<ul>
<li>Now our messages are printed to the screen as our workflow runs</li>
</ul>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>Provided<span class="w"> </span>cluster<span class="w"> </span>nodes:<span class="w"> </span><span class="m">20</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>Job<span class="w"> </span>stats:
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>job<span class="w">            </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>-----------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>all<span class="w">                </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>fastqc<span class="w">             </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>multiqc<span class="w">            </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>trim_galore<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>total<span class="w">              </span><span class="m">8</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>Job<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24694_1.fastq.gz<span class="w"> </span>../../data/NA24694_2.fastq.gz
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">4</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763840&#39;</span>.
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>Job<span class="w"> </span><span class="m">6</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24695.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>
<a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">6</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763841&#39;</span>.
<a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>
<a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a>Job<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24631_1.fastq.gz<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a>
<a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">2</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763842&#39;</span>.
<a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a>
<a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a>Job<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24695_1.fastq.gz<span class="w"> </span>../../data/NA24695_2.fastq.gz
<a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a>
<a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">3</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763843&#39;</span>.
<a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a>
<a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a>Job<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24631.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a>
<a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">5</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763844&#39;</span>.
<a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a>
<a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a>Job<span class="w"> </span><span class="m">7</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24694.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a>
<a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">7</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763845&#39;</span>.
<a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">4</span>.
<a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">12</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">6</span>.
<a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">25</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">2</span>.
<a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a><span class="m">3</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">38</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">3</span>.
<a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a><span class="m">4</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a>
<a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a>Job<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Compiling<span class="w"> </span>a<span class="w"> </span>HTML<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks.<span class="w"> </span>Writing<span class="w"> </span>to<span class="w"> </span>../results/multiqc_report.html.
<a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a>
<a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">1</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763848&#39;</span>.
<a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">5</span>.
<a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a><span class="m">5</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">62</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">7</span>.
<a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a><span class="m">6</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">75</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a><span class="m">7</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">88</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a>
<a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a>localrule<span class="w"> </span>all:
<a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a><span class="w">    </span>input:<span class="w"> </span>../results/multiqc_report.html,<span class="w"> </span>../results/trimmed/NA24631_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24631_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_2_val_2.fq.gz
<a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">mem_mb</span><span class="o">=</span><span class="m">512</span>,<span class="w"> </span><span class="nv">disk_mb</span><span class="o">=</span><span class="m">1000</span>,<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281,<span class="w"> </span><span class="nv">cpus</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">time_min</span><span class="o">=</span><span class="m">10</span>
<a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a>
<a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a id="__codelineno-49-81" name="__codelineno-49-81" href="#__codelineno-49-81"></a><span class="m">8</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-49-82" name="__codelineno-49-82" href="#__codelineno-49-82"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T132052.454902.snakemake.log
</code></pre></div>
</details>
</div>
<p><br></p>
<h2 id="45-create-temporary-files">4.5 Create temporary files<a class="headerlink" href="#45-create-temporary-files" title="Permanent link">&para;</a></h2>
<p>In our workflow, we are likely to be creating files that we don't want, but are used or produced by our workflow (intermediate files). We can mark such files as temporary so Snakemake will remove the file once it doesn't need to use it anymore.</p>
<p>For example, we might not want to keep our fastqc output files since our multiqc report merges all of our fastqc reports for each sample into one report. Let's have a look at the files currently produced by our workflow with:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>total<span class="w"> </span><span class="m">4</span>.5M
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>250K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_1_fastqc.html
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_1_fastqc.zip
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>249K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_2_fastqc.html
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_2_fastqc.zip
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>254K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_1_fastqc.html
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>334K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_1_fastqc.zip
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>250K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_2_fastqc.html
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_2_fastqc.zip
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>252K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_1_fastqc.html
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_1_fastqc.zip
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>253K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_2_fastqc.html
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>330K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_2_fastqc.zip
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Let's mark all the trimmed fastq files as temporary in our Snakefile by wrapping it up in the <code>temp()</code> function</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a># define our configuration file
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>configfile: &quot;../config/config.yaml&quot;
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a># define samples from data directory using wildcards
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>rule all:
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w"> </span>   input:
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a># workflow
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a>rule fastqc:
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w"> </span>   input:
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="w"> </span>   output:
<a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="gd">-       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],</span>
<a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="gi">+       html = temp([&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;]),</span>
<a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="w"> </span>   params:
<a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="w"> </span>       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]
<a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="w"> </span>   log:
<a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="w"> </span>       &quot;FastQC/0.11.9&quot;
<a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a><span class="w"> </span>   message:
<a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="w"> </span>       &quot;Undertaking quality control checks {input}&quot;
<a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="w"> </span>   shell:
<a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a>
<a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a>rule multiqc:
<a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a><span class="w"> </span>   input:
<a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="w"> </span>   output:
<a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w"> </span>   params:
<a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="w"> </span>       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]
<a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a><span class="w"> </span>   log:
<a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="w"> </span>       &quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;
<a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a><span class="w"> </span>   message:
<a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a><span class="w"> </span>       &quot;Compiling a HTML report for quality control checks. Writing to {output}.&quot;
<a id="__codelineno-52-47" name="__codelineno-52-47" href="#__codelineno-52-47"></a><span class="w"> </span>   shell:
<a id="__codelineno-52-48" name="__codelineno-52-48" href="#__codelineno-52-48"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-52-49" name="__codelineno-52-49" href="#__codelineno-52-49"></a>
<a id="__codelineno-52-50" name="__codelineno-52-50" href="#__codelineno-52-50"></a>rule trim_galore:
<a id="__codelineno-52-51" name="__codelineno-52-51" href="#__codelineno-52-51"></a><span class="w"> </span>   input:
<a id="__codelineno-52-52" name="__codelineno-52-52" href="#__codelineno-52-52"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-52-53" name="__codelineno-52-53" href="#__codelineno-52-53"></a><span class="w"> </span>   output:
<a id="__codelineno-52-54" name="__codelineno-52-54" href="#__codelineno-52-54"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-52-55" name="__codelineno-52-55" href="#__codelineno-52-55"></a><span class="w"> </span>   params:
<a id="__codelineno-52-56" name="__codelineno-52-56" href="#__codelineno-52-56"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-52-57" name="__codelineno-52-57" href="#__codelineno-52-57"></a><span class="w"> </span>   log:
<a id="__codelineno-52-58" name="__codelineno-52-58" href="#__codelineno-52-58"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-52-59" name="__codelineno-52-59" href="#__codelineno-52-59"></a><span class="w"> </span>   envmodules:
<a id="__codelineno-52-60" name="__codelineno-52-60" href="#__codelineno-52-60"></a><span class="w"> </span>       &quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;
<a id="__codelineno-52-61" name="__codelineno-52-61" href="#__codelineno-52-61"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-52-62" name="__codelineno-52-62" href="#__codelineno-52-62"></a><span class="w"> </span>   resources:
<a id="__codelineno-52-63" name="__codelineno-52-63" href="#__codelineno-52-63"></a><span class="w"> </span>       cpus=8
<a id="__codelineno-52-64" name="__codelineno-52-64" href="#__codelineno-52-64"></a><span class="w"> </span>   message:
<a id="__codelineno-52-65" name="__codelineno-52-65" href="#__codelineno-52-65"></a><span class="w"> </span>       &quot;Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads.&quot;
<a id="__codelineno-52-66" name="__codelineno-52-66" href="#__codelineno-52-66"></a><span class="w"> </span>   shell:
<a id="__codelineno-52-67" name="__codelineno-52-67" href="#__codelineno-52-67"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># define our configuration file</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">configfile</span><span class="p">:</span> <span class="s2">&quot;../config/config.yaml&quot;</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="c1"># workflow</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">temp</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">]),</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>        <span class="s2">&quot;FastQC/0.11.9&quot;</span>
<a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a>        <span class="s2">&quot;Undertaking quality control checks </span><span class="si">{input}</span><span class="s2">&quot;</span>
<a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a>
<a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-53-39" name="__codelineno-53-39" href="#__codelineno-53-39"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-53-40" name="__codelineno-53-40" href="#__codelineno-53-40"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-53-41" name="__codelineno-53-41" href="#__codelineno-53-41"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-53-42" name="__codelineno-53-42" href="#__codelineno-53-42"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-53-43" name="__codelineno-53-43" href="#__codelineno-53-43"></a>        <span class="s2">&quot;MultiQC/1.9-gimkl-2020a-Python-3.8.2&quot;</span>
<a id="__codelineno-53-44" name="__codelineno-53-44" href="#__codelineno-53-44"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-53-45" name="__codelineno-53-45" href="#__codelineno-53-45"></a>        <span class="s2">&quot;Compiling a HTML report for quality control checks. Writing to </span><span class="si">{output}</span><span class="s2">.&quot;</span>
<a id="__codelineno-53-46" name="__codelineno-53-46" href="#__codelineno-53-46"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-53-47" name="__codelineno-53-47" href="#__codelineno-53-47"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-53-48" name="__codelineno-53-48" href="#__codelineno-53-48"></a>
<a id="__codelineno-53-49" name="__codelineno-53-49" href="#__codelineno-53-49"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-53-50" name="__codelineno-53-50" href="#__codelineno-53-50"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-53-51" name="__codelineno-53-51" href="#__codelineno-53-51"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-53-52" name="__codelineno-53-52" href="#__codelineno-53-52"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-53-53" name="__codelineno-53-53" href="#__codelineno-53-53"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-53-54" name="__codelineno-53-54" href="#__codelineno-53-54"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-53-55" name="__codelineno-53-55" href="#__codelineno-53-55"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-53-56" name="__codelineno-53-56" href="#__codelineno-53-56"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-53-57" name="__codelineno-53-57" href="#__codelineno-53-57"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-53-58" name="__codelineno-53-58" href="#__codelineno-53-58"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a id="__codelineno-53-59" name="__codelineno-53-59" href="#__codelineno-53-59"></a>        <span class="s2">&quot;TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1&quot;</span>
<a id="__codelineno-53-60" name="__codelineno-53-60" href="#__codelineno-53-60"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-53-61" name="__codelineno-53-61" href="#__codelineno-53-61"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-53-62" name="__codelineno-53-62" href="#__codelineno-53-62"></a>        <span class="n">cpus</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-53-63" name="__codelineno-53-63" href="#__codelineno-53-63"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-53-64" name="__codelineno-53-64" href="#__codelineno-53-64"></a>        <span class="s2">&quot;Trimming using these parameter: </span><span class="si">{params}</span><span class="s2">. Writing logs to </span><span class="si">{log}</span><span class="s2">. Using </span><span class="si">{threads}</span><span class="s2"> threads.&quot;</span>
<a id="__codelineno-53-65" name="__codelineno-53-65" href="#__codelineno-53-65"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-53-66" name="__codelineno-53-66" href="#__codelineno-53-66"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a># remove output of last run
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>rm -r ../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div></p>
</div>
<div class="admonition terminal-2">
<p class="admonition-title">Now when we have a look at the <code>../results/fastqc/</code> directory with:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<ul>
<li>These html files have been removed once Snakemake no longer needs the files for another rule/operation, and we've saved some space on our computer (from 4.5 megabytes to 3 megabytes in this directory).</li>
</ul>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>total<span class="w"> </span><span class="m">3</span>.0M
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24631_1_fastqc.zip
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24631_2_fastqc.zip
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>334K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24694_1_fastqc.zip
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24694_2_fastqc.zip
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24695_1_fastqc.zip
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>330K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24695_2_fastqc.zip
</code></pre></div>
</details>
</div>
<p><br></p>
<div class="admonition note">
<p>This becomes particularly important when our data become big data, since we don't want to keep any massive intermediate output files that we don't need. Otherwise this can start to clog up the memory on our computer. It ensures our workflow is scalable when our data becomes big data.</p>
</div>
<h2 id="46-generating-a-snakemake-report">4.6 Generating a snakemake report<a class="headerlink" href="#46-generating-a-snakemake-report" title="Permanent link">&para;</a></h2>
<p>With Snakemake, we can automatically generate detailed self-contained HTML reports after we run our workflow with the following command:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>snakemake<span class="w"> </span>--report<span class="w"> </span>../results/snakemake_report.html
</code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>you won't be able to view a rendered version of this html while it is on the remote server, however after you transfer it to your local computer you should be able to view it in your web browser*</p>
</div>
<p>In our report:</p>
<ul>
<li>We get an interactive version of our directed acyclic graph (DAG).</li>
<li>When you click on a node in the DAG, the input and output files are fully outlined, the exact software used and the exact shell command that was run.</li>
<li>You are also provided with runtime information under the <code>Statistics</code> tab outlining how long each rule/sample ran for, and the date/time each file was created.</li>
</ul>
<div class="admonition html5">
<p class="admonition-title">My report</p>
<p><a class="glightbox" href="../images/snakemake_report.gif" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="snakemake_report" src="../images/snakemake_report.gif" /></a></p>
</div>
<p><br></p>
<p>These reports are highly configurable, have a look at an example of what can be done with a report <a href="https://koesterlab.github.io/resources/report.html">here</a></p>
<p><em>See more information on creating Snakemake reports <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/reporting.html">in the Snakemake documentation</a></em></p>
<h2 id="47-linting-your-workflow">4.7 Linting your workflow<a class="headerlink" href="#47-linting-your-workflow" title="Permanent link">&para;</a></h2>
<p>Snakemake has a built in linter to support you building best practice workflows, let's try it out:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>snakemake<span class="w"> </span>--lint
</code></pre></div>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>Lints<span class="w"> </span><span class="k">for</span><span class="w"> </span>rule<span class="w"> </span>fastqc<span class="w"> </span><span class="o">(</span>line<span class="w"> </span><span class="m">21</span>,<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile<span class="o">)</span>:
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">    </span>*<span class="w"> </span>Additionally<span class="w"> </span>specify<span class="w"> </span>a<span class="w"> </span>conda<span class="w"> </span>environment<span class="w"> </span>or<span class="w"> </span>container<span class="w"> </span><span class="k">for</span><span class="w"> </span>each<span class="w"> </span>rule,<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>not<span class="w"> </span>enough:
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">      </span>While<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>allow<span class="w"> </span>to<span class="w"> </span>document<span class="w"> </span>and<span class="w"> </span>deploy<span class="w"> </span>the<span class="w"> </span>required<span class="w"> </span>software<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>certain<span class="w"> </span>platform,<span class="w"> </span>they<span class="w"> </span>lock<span class="w"> </span>your<span class="w"> </span>workflow<span class="w"> </span><span class="k">in</span><span class="w"> </span>there,<span class="w"> </span>disabling<span class="w"> </span>easy<span class="w"> </span>reproducibility<span class="w"> </span>on
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">      </span>other<span class="w"> </span>machines<span class="w"> </span>that<span class="w"> </span>don<span class="s1">&#39;t have exactly the same environment modules. Hence env modules (which might be beneficial in certain cluster environments), should allways be</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="s1">      complemented with equivalent conda environments.</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="s1">      Also see:</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="s1">      https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#integrated-package-management</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="s1">      https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#running-jobs-in-containers</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="s1">Lints for rule multiqc (line 61, /scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile):</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="s1">    * Additionally specify a conda environment or container for each rule, environment modules are not enough:</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="s1">      While environment modules allow to document and deploy the required software on a certain platform, they lock your workflow in there, disabling easy reproducibility on</span>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="s1">      other machines that don&#39;</span>t<span class="w"> </span>have<span class="w"> </span>exactly<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>environment<span class="w"> </span>modules.<span class="w"> </span>Hence<span class="w"> </span>env<span class="w"> </span>modules<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>might<span class="w"> </span>be<span class="w"> </span>beneficial<span class="w"> </span><span class="k">in</span><span class="w"> </span>certain<span class="w"> </span>cluster<span class="w"> </span>environments<span class="o">)</span>,<span class="w"> </span>should<span class="w"> </span>allways<span class="w"> </span>be
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">      </span>complemented<span class="w"> </span>with<span class="w"> </span>equivalent<span class="w"> </span>conda<span class="w"> </span>environments.
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">      </span>Also<span class="w"> </span>see:
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#integrated-package-management
<a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#running-jobs-in-containers
<a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a>
<a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a>Lints<span class="w"> </span><span class="k">for</span><span class="w"> </span>rule<span class="w"> </span>trim_galore<span class="w"> </span><span class="o">(</span>line<span class="w"> </span><span class="m">96</span>,<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile<span class="o">)</span>:
<a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a><span class="w">    </span>*<span class="w"> </span>Additionally<span class="w"> </span>specify<span class="w"> </span>a<span class="w"> </span>conda<span class="w"> </span>environment<span class="w"> </span>or<span class="w"> </span>container<span class="w"> </span><span class="k">for</span><span class="w"> </span>each<span class="w"> </span>rule,<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>not<span class="w"> </span>enough:
<a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a><span class="w">      </span>While<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>allow<span class="w"> </span>to<span class="w"> </span>document<span class="w"> </span>and<span class="w"> </span>deploy<span class="w"> </span>the<span class="w"> </span>required<span class="w"> </span>software<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>certain<span class="w"> </span>platform,<span class="w"> </span>they<span class="w"> </span>lock<span class="w"> </span>your<span class="w"> </span>workflow<span class="w"> </span><span class="k">in</span><span class="w"> </span>there,<span class="w"> </span>disabling<span class="w"> </span>easy<span class="w"> </span>reproducibility<span class="w"> </span>on
<a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a><span class="w">      </span>other<span class="w"> </span>machines<span class="w"> </span>that<span class="w"> </span>don<span class="err">&#39;</span>t<span class="w"> </span>have<span class="w"> </span>exactly<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>environment<span class="w"> </span>modules.<span class="w"> </span>Hence<span class="w"> </span>env<span class="w"> </span>modules<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>might<span class="w"> </span>be<span class="w"> </span>beneficial<span class="w"> </span><span class="k">in</span><span class="w"> </span>certain<span class="w"> </span>cluster<span class="w"> </span>environments<span class="o">)</span>,<span class="w"> </span>should<span class="w"> </span>allways<span class="w"> </span>be
<a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a><span class="w">      </span>complemented<span class="w"> </span>with<span class="w"> </span>equivalent<span class="w"> </span>conda<span class="w"> </span>environments.
<a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a><span class="w">      </span>Also<span class="w"> </span>see:
<a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#integrated-package-management
<a id="__codelineno-60-26" name="__codelineno-60-26" href="#__codelineno-60-26"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#running-jobs-in-containers
</code></pre></div>
</details>
</div>
<p><br></p>
<p>We have a few things we could improve in our workflow!</p>
<p>Writing a best practice workflow is more important than having Marie Kondo level tidiness, it increases the chance your workflow will continue to be used and maintained by others (and ourselves), making the code we write useful (it's exciting seeing someone else using your code!). If your workflow was used in scientific research, it makes your workflow accessible for people to reproduce your research findings; it isn't going to be a nightmare for them to run and they are more likely to try and have success doing so.</p>
<p>Read more about the <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html">best practices for Snakemake</a></p>
<h1 id="takeaways">Takeaways<a class="headerlink" href="#takeaways" title="Permanent link">&para;</a></h1>
<hr />
<div class="admonition quote">
<ul>
<li>Pull out your parameters and put them in <code>params:</code> directive</li>
<li>Pulling the user configurable options away from the core workflow will support reproducibility by reducing the chance of changes to the core workflow</li>
<li>Leaving messages for the user of your workflow will help them understand what is happening at each stage and follow the workflows progress</li>
<li>Mark files you won't need once the workflow completes to reduce the memory usage - <em>particularly</em> when dealing with big data</li>
<li>Generate a snakemake report to get a summary of the workflow run - these are highly configurable</li>
<li>Lint your workflow and check it complies with best practices - this supports reproducibility and portability</li>
<li>There is so much more to explore, such as creating <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/modularization.html">modular workflows</a>, automatically grabbing <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/remote_files.html">remote files</a> from places like Google Cloud Storage and Dropbox, <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#external-scripts">run various types of scripts</a> such as <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#python">python scripts</a>, <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#r-and-r-markdown">R and RMarkdown scripts</a> and <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#jupyter-notebook-integration">Jupyter Notebooks</a></li>
</ul>
</div>
<hr />
<h1 id="summary-commands">Summary commands<a class="headerlink" href="#summary-commands" title="Permanent link">&para;</a></h1>
<div class="admonition terminal">
<ul>
<li>Use the parameter directive (<code>params</code>) to keep the parameters and flags of your programs separate from your shell command, for example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>params:
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">    </span><span class="s2">&quot;--paired&quot;</span>
</code></pre></div>
<ul>
<li>Run your snakemake workflow (using environment modules to load your software AND with a configuration file) with:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules<span class="w"> </span>--configfile<span class="w"> </span>../config/config.yaml
</code></pre></div>
<ul>
<li>Alternatively, define your config file in the Snakefile:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>configfile:<span class="w"> </span><span class="s2">&quot;../config/config.yaml&quot;</span>
</code></pre></div>
<ul>
<li>Use the <code>message</code> directive to provide information to the user on what is happening real time, for example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>message:
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">    </span><span class="s2">&quot;Undertaking quality control checks {input}&quot;</span>
</code></pre></div>
<ul>
<li>Mark temporary files to remove (once they are no longer needed by the workflow) with <code>temp()</code>, for example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>temp<span class="o">([</span><span class="s2">&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;</span>,<span class="w"> </span><span class="s2">&quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;</span><span class="o">])</span>
</code></pre></div>
<ul>
<li>Create a basic interactive Snakemake report after running your workflow with:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>snakemake<span class="w"> </span>--report<span class="w"> </span>../results/snakemake_report.html
</code></pre></div>
</div>
<h1 id="our-final-snakemake-workflow">Our final snakemake workflow!<a class="headerlink" href="#our-final-snakemake-workflow" title="Permanent link">&para;</a></h1>
<p>See <a href="https://github.com/nesi/snakemake_workshop/tree/main/leveled_up_demo_workflow">leveled_up_demo_workflow</a> for the final Snakemake workflow we've created up to this point</p>
<hr />
<p align="center"><b><a class="btn" href="https://nesi.github.io/snakemake_workshop/" style="background: var(--bs-dark);font-weight:bold">Back to homepage</a></b></p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../03_create_a_basic_workflow/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 03 - Create a basic workflow" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                03 - Create a basic workflow
              </div>
            </div>
          </a>
        
        
          
          <a href="../05_we_want_more/" class="md-footer__link md-footer__link--next" aria-label="Next: 05 - We want more!" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                05 - We want more!
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Snakemake workshop material is licensed under a <a rel="noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>